window.matchMedia=window.matchMedia||function(a){var c,d=a.documentElement,e=d.firstElementChild||d.firstChild,f=a.createElement("body"),g=a.createElement("div");return g.id="mq-test-1",g.style.cssText="position:absolute;top:-100em",f.style.background="none",f.appendChild(g),function(a){return g.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',d.insertBefore(f,e),c=42==g.offsetWidth,d.removeChild(f),{matches:c,media:a}}}(document),function(){if(!window.matchMedia("").addListener){var a=window.matchMedia;window.matchMedia=function(b){var f,c=a(b),d=[],e=!1,g=function(){var f=a(b),g=f.matches&&!e,h=!f.matches&&e;if(g||h)for(var i=0,j=d.length;j>i;i++)d[i].call(c,f);e=f.matches};return c.addListener=function(a){d.push(a),f||(f=setInterval(g,1e3))},c.removeListener=function(a){for(var b=0,c=d.length;c>b;b++)d[b]===a&&d.splice(b,1);!d.length&&f&&clearInterval(f)},c}}}(),void 0===window.console&&(console={log:function(){}});var mob={}||mob;(function(){function c(a,b,c){var d=window.getComputedStyle(a)[b];return d=c===!0?+parseFloat(d)||0:d}function e(a){return a?!1:!0}function f(a,b){a.style.webkitTransition=b,a.style.MozTransition=b,a.style.msTransition=b,a.style.OTransition=b,a.style.transition=b}var a=document;a.styleSheets,mob={name:"mob.js",version:"0.5",defaults:{requestType:"%fx%w.%e",autoStart:!0,autoReload:!0,retinaSupport:!1,offsetHeight:100,offsetWidth:100,minHeight:200,minWidth:200,lazyLoad:!0},scrollTimer:!1,__preventEvent:!0,__viewportHeight:0,__viewportWidth:0,__basket:[],__book:[],setConfig:function(a){var b=this.config;for(var c in a)b[c]=void 0===b[c]?a[c]:b[c];return b.DPR=b.retinaSupport&&window.devicePixelRatio>1?window.devicePixelRatio:1,b},touch:function(){this.config=this.setConfig(this.defaults),this.config.autoStart&&this.init()},init:function(){var a=this.config;a.lazyLoad&&window.addEventListener("scroll",function(){mob.setShowBooks()}),a.autoReload&&this.addMQListener(),this.refresh()},refresh:function(){this.__basket=[];for(var b=a.getElementsByTagName("img"),d=b.length;d--;){var e=b[d].getAttribute("data-src");if(null!==e){b[d]._file=e.split(/(?:\.([^.]+))?$/);var f=c(b[d],"minHeight"),g=c(b[d],"minWidth");b[d].style.minHeight=""===f?this.config.minHeight+"px":f,b[d].style.minWidth=""===g?this.config.minWidth+"px":g,b[d].style.opacity=0,this.__basket.push(b[d])}}this.resetBooks()},resetBooks:function(){if(this.__preventEvent=e(this.__preventEvent),this.__preventEvent===!1){this.__book=[];for(var a=this.__basket.length;a--;){var b=this.__basket[a],d={};d._width=c(b,"width",!0),d._height=c(b,"height",!0),d._display=c(b,"display"),(void 0===b._width||void 0===b._height||d._width>b._width||d._height>b._height)&&"none"!==d._display&&(b.position=b.getBoundingClientRect(),b._width=d._width,b._height=d._height,this.__book.push(b))}this.showBooks()}},showBooks:function(){function c(a){return Math.min(document.body[a],document.documentElement[a])}var a="showElement";this.config.lazyLoad&&(this.__viewportHeight=c("clientHeight"),this.__viewportWidth=c("clientWidth"),a="checkPosition",this.bodyRect=document.body.getBoundingClientRect());for(var b=0;this.__book.length-1>=b;b++)void 0!==this.__book[b]&&this[a](this.__book[b])},checkPosition:function(a){var b=a.position,c=this.bodyRect;f(a,"opacity ease 0.6s"),b.top+c.top<=this.__viewportHeight&&b.left+c.left<=this.__viewportWidth&&this.showElement(a)},showElement:function(a){var b=this.config.requestType,c=a._file,d=Math.ceil(this.config.DPR*a._width),e=Math.ceil(this.config.DPR*a._height),f=b.replace("%f",c[0]).replace("%w",d).replace("%h",e).replace("%e",c[1]);a.src!==f&&(a.src=f,a.addEventListener("load",function(){mob.setAttribute(this)}),a.addEventListener("error",function(b){console.log(b.status+"Can't load - "+this._file[0]+"."+this._file[1]);var c=mob.__book.indexOf(a);c>=0&&mob.__book.splice(c,1)}))},setAttribute:function(a){a.style.opacity=1,this.__basket.indexOf(a);var c=this.__book.indexOf(a);c>=0&&this.__book.splice(c,1)},addMQListener:function(){for(var a=document.styleSheets,b=a.length;b--;)for(var c=a[b].cssRules,d=c.length,e=d;e--;)if(void 0!==c[e].media){var f=c[e].media.mediaText;eventObject=this["mediaQuery"+e]=window.matchMedia(f),eventObject.addListener(function(){mob.resetBooks()})}},setShowBooks:function(){this.__book.length&&(clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(function(){mob.showBooks()},150))}},window.addEventListener("load",function(){mob.touch()})})();